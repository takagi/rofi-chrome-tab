#!/bin/bash

if [[ $# -eq 0 ]]; then
    # Use find instead of ls to safely handle glob patterns
    find /tmp -name "native-app*.sock" 2>/dev/null | while read -r sock; do
        echo list | nc -U "${sock}"
    done
else
    # Validate input before processing
    if [[ ! "$1" =~ ^[0-9]+,[0-9]+, ]]; then
        echo "Error: Invalid input format" >&2
        exit 1
    fi
    
    pid=$(echo "$1" | cut -d , -f 1)
    tab_id=$(echo "$1" | cut -d , -f 2)
    
    # Send select command
    echo "select ${tab_id}" | nc -U "/tmp/native-app.${pid}.sock"
    
    # Focus window using appropriate window manager
    if command -v i3-msg &> /dev/null; then
        i3-msg '[urgent=latest] focus' > /dev/null
    elif command -v swaymsg &> /dev/null; then
        swaymsg '[urgent=latest] focus' > /dev/null
    elif command -v wmctrl &> /dev/null; then
        # wmctrl works with many window managers
        wmctrl -a chrome > /dev/null 2>&1 || wmctrl -a chromium > /dev/null 2>&1
    fi
    # If no known window manager is found, silently continue (command already executed)
fi
 
